---
title: "Pathway model report"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
bibliography: references.bib
params:
  ntrade: NA
  model_def: NA
  param_names: NA
  par_settings: NA
  n_iter: NA
  dist_result: NA
  Ninf: NA
  Ninf_EU: NA
  nuts_level: NA
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE,
                      fig.pos = 'h',
                      fig.align = 'center',
                      fig.height = 3,
                      fig.width = 4)
```

```{r}
ntrade <- params$ntrade # Ntrade data
model_def <- params$model_def # model equation
param_names <- params$param_names # parameter names
n_iter <- params$n_iter # number of iterations
par_settings <- params$par_settings # Parameter distributions
dist_result <- params$dist_result # random values generated from the distributions
Ninf <- params$Ninf # Ninf results
Ninf_EU <- params$Ninf_EU # Ninf results total EU
NUTS_lev <- params$nuts_level #selected NUTS (depending on the Excel Ntrade file chosen)

```


# Introduction

This report presents the results of the pathway model analysis conducted using 
the Pathway model Shiny app. Data were processed employing the *qPRAentry* 
package.

The pathway model provides an estimation of the number of pest individuals, spores, 
or propagules entering a risk assessment area through various trade pathways.

The European Food Safety Authority (EFSA) utilises pathway models to evaluate the 
risk of pests entering the EU territories. The complexity of the pathway model 
can vary based on factors such as the specific pest under consideration and the 
availability of detailed data.

The pathway model essentially multiplies the trade flow data by several factors 
that account for pest prevalence in the traded products and the effectiveness 
of entry processes in mitigating pest introduction, from the source country of 
origin to the EU. Additional information can be found in the EFSA Guidance on 
quantitative pest risk assessment [@efsa2018guidance].

Due to the challenges in obtaining precise data for each stage of a pest risk assessment, 
Expert Knowledge Elicitation (EKE) is often employed to estimate the values of 
the pathway model parameters [@efsa2018guidance]. EKE is a structured process 
that gathers and utilises expert knowledge to make informed decisions, 
especially when empirical data is limited [@european2014guidance].



## Pathway model

The constructed pathway model and its corresponding parameters are presented below:

`r paste0("$$", model_def, "$$")`

The $N_{trade}$ data used in the model have been previously calculated using 
the $N_{trade}$ Shiny application, part of the *qPRAentry* package.

A total of `r n_iter` iterations were performed to randomly generate parameter 
values based on the specified distribution.

### Parameters: 

```{r, results='asis'}
param_names <- sapply(param_names, function(x) {
  if (!grepl("^\\$", x)) x <- paste0("$", x)
  if (!grepl("\\$$", x)) x <- paste0(x, "$")
  return(x)
})

for (i in seq_along(param_names)) {
  # Parameter name
  cat(paste0(param_names[i], "\n\n"))
  
  # Histogram
  plot.new()
  hist(dist_result[[i]], 
       main = par_settings[i], 
       xlab = "", 
       prob = TRUE,
       cex.main = 0.8, 
       cex.lab = 0.8)
  
  # space
  cat("\n\n")
}
```


# $\mathit{NPFP}$ results and download

The result of the pathway model is a data frame with the estimated number of 
potential founder populations $(\mathit{NPFP})$ for each country of interest i.
The table below displays the $\mathit{NPFP}$ results at NUTS`r NUTS_lev` level. 


```{r}

# Display the table
knitr::kable(Ninf, caption = "NPFP results", digits = 2) 

```

The map shows the median $\mathit{NPFP}$ values by NUTS`r NUTS_lev`.

```{r}

plot_nuts(Ninf, "NUTS_ID", "Median", nuts_level = NUTS_lev,
          title = "NPFP Median") +
   xlim(-20, 40) + ylim(35,70) +
   theme_bw()+
  theme(
     plot.title = element_text(size = 14),
     legend.title = element_text(size = 12)
   )

```
Figure 1: $\mathit{NPFP}$ values redistributed at the NUTS`r NUTS_lev` level.

The pathway model results are available in the downloaded Pathway_results20XX-XX-XX.zip folder.


# References


