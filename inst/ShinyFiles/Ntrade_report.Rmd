---
title: "Ntrade report"
output: pdf_document
params:
  time_period: NA
  units: NA
  Nt_result: NA
  Nt_redist: NA
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE,
                      fig.pos = 'h',
                      fig.align = 'center',
                      fig.height = 3,
                      fig.width = 4)
```

```{r}
#Available variables

time_period <- params$time_period
units <- params$units
Nt <- params$Nt_result
Nt_redist<- params$Nt_redist

```


# Introduction

This report details the results of the $N_{trade}$ analysis perdormed using the $N_{trade}$ Shiny application. Data were processed employing the *qPRAentry* package.

$N_{trade}$ is defined as the potentially infected quantity of commodities imported by a country (e.g., an EU country) from other third-countries where the pest is present. This application is meant to calculate $N_{trade}$ and redistribute the data into the countries considered.


### Calculation of $N_{trade}$

For a given country $i$, $N_{trade}$ is calculated as follows:

$$
N_{trade_i} = ExtraPest_i - ExtraPest_i \sum_{j \neq i} R_{ij} + \sum_{j \neq i} ExtraPest_j R_{ji},
$$

Where:

- **$ExtraPest_i$**: Quantity of non-EU commodity imported by country $i$ from countries where the pest is present.
- **$ExtraPest_j$**: Quantity of non-EU commodity imported by country $j$ from countries where the pest is present.
- **$R_{ij}$**: The proportion of $ExtraPest_i$ reexported from country $i$ to country $j$. This is calculated as:
  $$
  R_{ij} = \frac{IntraExp_{ij}}{Total_i}
  $$
  where $IntraExp_{ij}$ is the quantity of commodity exported from country $i$ to country $j$, and $Total_i$ is the total quantity of commodity available in country $i$, given by:
  $$
  Total_i = IP_i + ExtraTotal_i
  $$
  Here, $IP_i$ represents the internal production in country $i$, and $ExtraTotal_i$ is the total quantity of non-EU commodity imported by country $i$.
- **$R_{ji}$**: The proportion of $ExtraPest_j$ reexported from country $j$ to country $i$. This is calculated as:
  $$
  R_{ji} = \frac{IntraExp_{ji}}{Total_j}
  $$
  where $IntraExp_{ji}$ is the quantity of commodity exported from country $j$ to country $i$, and $Total_j$ is the total quantity of commodity available in country $j$.

### $N_{trade}$ reuslts

Below, the $N_{trade}$ results are displayed in both tabular and map formats.
The map shows the median $N_{trade}$ values by country at the NUTS0 level.

```{r}

# Display the table
knitr::kable(Nt, caption = "$N_{trade}$ results by Country", digits = 2) 
# %>%
#   kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))


plot_countries(Nt, "NUTS0", "Median", title = bquote(N[trade] ~ " Median")) +
   xlim(-20, 40) + ylim(35,70) +
   theme_bw()+
   theme(
     plot.title = element_text(size = 14),
     legend.title = element_text(size = 12)
   )

```
Figure 1: Median $N_{trade}$ values by country at the NUTS0 level.


# $N_{trade}$ redistribution

### Redistribution to NUTS2

After calculating $N_{trade}$ at the national level (NUTS0), the next step involves redistributing these quantities to NUTS2 regions. 

$N_{trade}$ redistribution to NUTS2 regions was performed depending on data selected by the user:  

```{r}


```

The selected years for population data are: `r time_period`

Below, the $N_{trade}$ redistribution results are displayed in map format. The table is available in the downloaded Ntrade_results20XX-XX-XX.zip folder.
The map shows the median $N_{trade}$ values by regions (NUTS2 level).

```{r}

#Vedere come si utilizza nell'esempio inviato da Martina

# plot_nuts2(Nt_redist, "NUTS2", "Median", title = bquote(N[trade] ~ " Median")) +
#    xlim(-20, 40) + ylim(35,70) +
#    theme_bw()+
#    theme(
#      plot.title = element_text(size = 14),
#      legend.title = element_text(size = 12)
#    )


```
Figure 2: $N_{trade}$ values redistributed at the NUTS2 level.




`r units` 



